<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualisasi Rute Terpendek - Dynamic Programming</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: #111;
            color: #eee;
            font-family: 'Segoe UI', sans-serif;
        }

        .app {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            height: calc(100vh - 80px);
            padding: 20px;
            align-items: stretch;
        }

        .left {
            width: 700px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .controls {
            text-align: center;
        }

        #peta {
            position: relative;
            flex: 1;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            min-height: 480px;
        }

        #log {
            flex: 1;
            background: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            font-size: 14px;
        }

        .node {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #007bff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: background 0.3s;
            z-index: 99999999;
        }

        .label-nama {
            position: absolute;
            text-align: center;
            width: 120px;
            transform: translate(-30%, 50px);
            color: #fff;
            font-size: 14px;
        }

        .garis {
            position: absolute;
            height: 2px;
            background: #888;
            transform-origin: 0 0;
            transition: background 0.3s;
        }

        .jarak {
            position: absolute;
            color: #fff;
            font-size: 13px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .aktif {
            background: orange !important;
        }

        .final {
            background: limegreen !important;
        }

        button {
            background: #007bff;
            border: none;
            color: white;
            padding: 8px 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        h3 {
            margin: 8px 0 0 0;
            font-size: 16px;
            line-height: 1.2;
            color: #eee;
        }

        #log b {
            color: #ffd;
        }

        hr {
            border: none;
            border-top: 1px solid #333;
            margin: 8px 0;
        }
    </style>
</head>

<body>
    <div style="margin-top: 24px; text-align: center;">
        <button onclick="mulaiPerhitungan()">â–¶ Mulai Perhitungan</button>
        <h3>Implementasi Algoritma Dynamic Programming untuk Optimasi Pencarian Rute Terpendek pada Sistem
            Distribusi Supplier di Perusahaan XYZ</h3>
    </divs>
    <div class="app">
        <div class="left">

            <div id="peta"></div>
        </div>

        <div id="log"></div>
    </div>

    <script>
        const lokasi = ["Supplier", "Gudang A", "Gudang B", "Gudang C", "Gudang D"];
        const koordinat = [
            { x: 100, y: 200 },
            { x: 300, y: 80 },
            { x: 500, y: 150 },
            { x: 350, y: 300 },
            { x: 150, y: 350 }
        ];
        const jarakAntarLokasi = [
            [0, 10, 15, 20, 18],
            [10, 0, 35, 25, 17],
            [15, 35, 0, 30, 20],
            [20, 25, 30, 0, 24],
            [18, 17, 20, 24, 0]
        ];

        const peta = document.getElementById("peta");
        const logEl = document.getElementById("log");
        let garisElemen = [];

        function buatPeta() {
            peta.innerHTML = "";
            garisElemen = [];

            lokasi.forEach((nama, i) => {
                const node = document.createElement("div");
                node.className = "node";
                node.textContent = i;
                node.style.left = koordinat[i].x + "px";
                node.style.top = koordinat[i].y + "px";
                peta.appendChild(node);

                const label = document.createElement("div");
                label.className = "label-nama";
                label.textContent = nama;
                label.style.left = koordinat[i].x + "px";
                label.style.top = koordinat[i].y + "px";
                peta.appendChild(label);
            });

            for (let i = 0; i < lokasi.length; i++) {
                for (let j = i + 1; j < lokasi.length; j++) {
                    const x1 = koordinat[i].x + 20, y1 = koordinat[i].y + 20;
                    const x2 = koordinat[j].x + 20, y2 = koordinat[j].y + 20;
                    const dx = x2 - x1, dy = y2 - y1;
                    const panjang = Math.sqrt(dx * dx + dy * dy);
                    const sudut = Math.atan2(dy, dx) * (180 / Math.PI);

                    const garis = document.createElement("div");
                    garis.className = "garis";
                    garis.style.width = panjang + "px";
                    garis.style.left = x1 + "px";
                    garis.style.top = y1 + "px";
                    garis.style.transform = `rotate(${sudut}deg)`;
                    peta.appendChild(garis);

                    const labelJarak = document.createElement("div");
                    labelJarak.className = "jarak";
                    labelJarak.textContent = jarakAntarLokasi[i][j];
                    labelJarak.style.left = (x1 + x2) / 2 + "px";
                    labelJarak.style.top = (y1 + y2) / 2 + "px";
                    peta.appendChild(labelJarak);

                    garisElemen.push({ i, j, el: garis });
                }
            }
        }

        function log(teks) {
            logEl.innerHTML += teks + "<br>";
            logEl.scrollTop = logEl.scrollHeight;
        }

        function getLine(i, j) {
            return garisElemen.find(g => (g.i === i && g.j === j) || (g.i === j && g.j === i));
        }

        async function highlightLine(i, j, warna = "aktif", durasi = 1000) {
            const g = getLine(i, j);
            if (!g) return;
            g.el.classList.add(warna);
            await new Promise(r => setTimeout(r, durasi));
            if (warna === "aktif") g.el.classList.remove(warna);
        }

        async function cariRuteTerpendek(jarakAntarLokasi) {
            const n = jarakAntarLokasi.length;
            const SUDAH = (1 << n) - 1;
            const dp = Array.from({ length: n }, () => Array(1 << n).fill(Infinity));
            const next = Array.from({ length: n }, () => Array(1 << n).fill(-1));

            // Disini esensi dynamic programmingnya karna memecah submasalah lalu ada pengunaan memoization dimana kalau sudah dihitung ndak perlu di hitung ulang langsung pakai saja
            async function solve(pos, mask) {
                if (mask === SUDAH) return jarakAntarLokasi[pos][0];

                if (dp[pos][mask] !== Infinity) return dp[pos][mask];

                for (let nxt = 0; nxt < n; nxt++) {
                    if ((mask & (1 << nxt)) === 0) {
                        log(`Coba dari <b>${lokasi[pos]}</b> ke <b>${lokasi[nxt]}</b> (jarak ${jarakAntarLokasi[pos][nxt]})`);
                        await highlightLine(pos, nxt);
                        const jarakTotal = jarakAntarLokasi[pos][nxt] + await solve(nxt, mask | (1 << nxt));

                        if (jarakTotal < dp[pos][mask]) {
                            dp[pos][mask] = jarakTotal;
                            next[pos][mask] = nxt;
                        }
                    }
                }
                return dp[pos][mask];
            }

            const hasil = await solve(0, 1);

            let path = [0], pos = 0, mask = 1;
            while (next[pos][mask] !== -1) {
                pos = next[pos][mask];
                path.push(pos);
                mask |= (1 << pos);
            }
            path.push(0);

            for (let k = 0; k < path.length - 1; k++) {
                const g = getLine(path[k], path[k + 1]);
                if (g) g.el.classList.add("final");
            }

            log("<hr><b>âœ… Jarak total terpendek:</b> " + hasil + "km");
            log("<b>ðŸšš Rute terbaik:</b> " + path.map(i => lokasi[i]).join(" â†’ "));
        }

        async function mulaiPerhitungan() {
            logEl.innerHTML = "";
            garisElemen.forEach(g => g.el.classList.remove("aktif", "final"));
            await cariRuteTerpendek(jarakAntarLokasi);
        }

        buatPeta();
    </script>
</body>

</html>